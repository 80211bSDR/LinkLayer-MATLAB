<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>IEEE 802.11b standard compliant link layer code for MATLAB-based SDR by 80211bSDR</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>IEEE 802.11b standard compliant link layer code for MATLAB-based SDR</h1>
          <h2>This work is supported by MathWorks under the Development-Collaboration Research Grant. We would appreciate a citation to our paper when this code is helpful in obtaining results in your future publications.</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/80211bSDR/LinkLayer-MATLAB/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/80211bSDR/LinkLayer-MATLAB/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/80211bSDR/LinkLayer-MATLAB" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>
<a id="linklayer-matlab" class="anchor" href="#linklayer-matlab" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>LinkLayer-MATLAB</h1>

<p>LinkLayer-MATLAB is a IEEE 802.11b Standard Compliant Link Layer (PHY and MAC layer) for MATLAB-based SDR. The code is highly modular and is entirely written in MATLAB. See each file for further documentation. The default settings in the files work well with our N210s using WBX daughterboards.</p>

<p>We model our system using a finite state machine (FSM) that transitions only on the clock cycles derived from the USRP clock, allowing for slot-time synchronized operations, thereby eliminating the need for external clocks. Futhermore, the model helps create a state-action based system design, wherein the same node switches between transmitter and receiver functions.</p>

<p>We adopt the IEEE 802.11b PHY and MAC layer packet structure specifications in our implementation. Our approach collects all the bits in the packet in multiples of 8 octets, which forms one USRP frame. This makes it easy for us to work with the MATLAB system objects and with PHY and MAC header fields in the DATA/ACK packet that happen to have sizes that are multiples of 8 octets. Multiple USRP frames will compose the standard-compliant 802.11b packet.</p>

<p>We implement <strong>DBPSK</strong> (differential binary phase shift keying) and <strong>DSSS</strong> direct sequence spread spectrum at the PHY layer and <strong>CSMA/CA</strong> (carrier sense multiple access with collision avoidance) at the MAC layer.</p>

<p>The consistent performance of the two node (1 DTx and 1 DRx; essentially a bi-directional link) and the three node (2 DTxs and 1 DRx) experimental results demonstrate the robustness of the system in mitigating packet collisions and enforcing fairness among nodes when accessing a common channel.</p>

<p>The current work provides a testbed to experiment with and enables creation of new MAC protocols starting from the fundamental IEEE 802.11b compliant standard.</p>

<p>This work is supported by <strong>MathWorks under the Development-Collaboration Research Grant</strong>. We would like to thank Mike McLernon and Ethem Sozer for their continued support on this project.</p>

<p>This code is licensed under the LGPLv3 license. Please feel free to use the code in your research and development works. We would appreciate a citation to the paper below when this code is helpful in obtaining results in your future publications. </p>

<p><strong>Publication for citation:</strong><br>
Ramanathan Subramanian, Benjamin Drozdenko, Eric Doyle, Rameez Ahmed, Miriam Leeser, and Kaushik Chowdhury, "<em>High-Level System Design of IEEE 802.11b Standard-Compliant Link Layer for MATLAB-based SDR</em>", accepted on March 3rd, 2016 for publication in IEEE Access Journal.</p>

<h2>
<a id="hardware-setup" class="anchor" href="#hardware-setup" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Hardware Setup</h2>

<p><img src="hwsetup.jpg" width="600"></p>

<h3>
<a id="a-configuring-ubuntu-os-settings--ettus-research-usrp-n210-device-setup" class="anchor" href="#a-configuring-ubuntu-os-settings--ettus-research-usrp-n210-device-setup" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>(A) Configuring Ubuntu OS Settings &amp; Ettus Research USRP N210 Device Setup</h3>

<h4>
<a id="1-ethernet-settings" class="anchor" href="#1-ethernet-settings" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1) Ethernet settings</h4>

<p><strong>a)</strong> Identify the <strong>eth#</strong> that is NOT connected to the internet.</p>

<pre lang="eval=FALSE"><code>&gt; ifconfig
</code></pre>

<p><strong>b)</strong> If it is called, say, <code>eth1</code>, then change the ethernet settings on the card connected to the USRP to use a static IP address (e.g. 192.168.10.1 for DTx, or 192.168.20.1 for DRx). To do this temporarily:</p>

<pre lang="eval=FALSE"><code>&gt; sudo ifconfig eth1 192.168.10.1 netmask 255.255.255.0
&gt; ifconfig eth1
</code></pre>

<p><strong>c)</strong> Confirm that eth# has changed appropriately<br>
<strong>Note</strong>: By default, <code>dhclient</code> will be running for your the ethernet configuration, so, eventually this setting will be overwritten, unless you make a permanent change to the <strong>/etc/network/interfaces</strong> file. To do this permanently: </p>

<pre lang="eval=FALSE"><code>&gt; cd /etc/network
&gt; sudo chmod 777 interfaces
&gt; vi interfaces
</code></pre>

<p><strong>d)</strong> Append the following lines to the end of the file: </p>

<pre lang="eval=FALSE"><code> #USRP configuration
 auto eth1
 iface eth1 inet static
    address   192.168.10.1
    netmask   255.255.255.0
    network   192.168.10.0
    broadcast 192.168.10.255 
</code></pre>

<p>Then, logout and log back in.</p>

<h4>
<a id="2-max-os-sendreceive-buffer-size" class="anchor" href="#2-max-os-sendreceive-buffer-size" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>2) Max. OS send/receive buffer size</h4>

<p><strong>a)</strong> Set the max. OS send buffer size (wmem) and receive buffer size (rmem) for queues on all protocols.
To do this temporarily: </p>

<pre lang="eval=FALSE"><code>&gt; sudo sysctl -w net.core.wmem_max=1048576
&gt; sudo sysctl -w net.core.rmem_max=50000000
</code></pre>

<p><strong>b)</strong> Note that, by default, these changes will be overwritten the next time you logout and log back into your Ubuntu machine, unless you make a permanent change to the /etc/sysctl.conf file. 
To do this permanently: </p>

<pre lang="eval=FALSE"><code>&gt; cd /etc
&gt; sudo chmod 777 sysctl.conf
&gt; vi sysctl.conf
</code></pre>

<p><strong>c)</strong> Append the following lines to the end of the file:</p>

<pre lang="eval=FALSE"><code>net.core.wmem_max=1048576
net.core.rmem_max=50000000
</code></pre>

<p>Then, logout and log back in. </p>

<h4>
<a id="3-thread-priority" class="anchor" href="#3-thread-priority" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3) Thread Priority</h4>

<p><strong>a)</strong> Set the maximum real-time priority for the "usrp" group and your user name.  This action gives our transmitter-receiver routines a high thread scheduling priority, so that they won't be preempted by other threads.
To do this permanently: </p>

<pre lang="eval=FALSE"><code>&gt; cd /etc/security
&gt; sudo chmod 777 limits.conf
&gt; vi limits.conf
</code></pre>

<p><strong>b)</strong> Append the following lines to the end of the file (<strong>before "# End of file"</strong>): </p>

<pre lang="eval=FALSE"><code> @usrp  -    rtprio    50
 ram    -    rtprio    50
</code></pre>

<p>where, in place of "ram", you put your Unix login name. </p>

<h3>
<a id="b-matlab-r2015b-communications-system-toolbox-usrp-support-package-setup" class="anchor" href="#b-matlab-r2015b-communications-system-toolbox-usrp-support-package-setup" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>(B) MATLAB R2015b Communications System Toolbox USRP Support Package Setup</h3>

<h4>
<a id="1-where-to-install-the-usrp-support-package" class="anchor" href="#1-where-to-install-the-usrp-support-package" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1) Where to install the USRP support package?</h4>

<p>In reality, the USRP support package can be installed in any directory with write permissions on any machine. The reason we decided to install only in the <strong>"/usr/local/MATLAB/2014b/<code>SupportPackages</code>"</strong> directory is because of the following:<br>
<strong>a.</strong> We need to choose a directory for the USRP support package to be installed in that is the same on all the Ubuntu machines. This way, any MEX files we create, which have the <em>usrproot</em> install folder hard-coded within them, can reference the USRP support package shared libraries in the same location on any lab machine.<br>
<strong>b.</strong> This directory must be accessible by all User accounts that need to run the USRP Support Package (sdru) System objects and transceive functions. That's why the install directory cannot be in the default /home/, since permissions in any home directory are always set to only allow a specific user to access his own files.</p>

<h4>
<a id="2-usrp-support-package-installation-steps" class="anchor" href="#2-usrp-support-package-installation-steps" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>2) USRP Support Package Installation Steps:</h4>

<p><strong>a)</strong> Start the GUI wizard by typing the <strong>supportPackageInstaller</strong> command in MATLAB. Download the USRP support package <code>usrpradio_download</code> to a folder, e.g. <strong>/home/ram/Documents/MATLAB/SupportPackages/R2015b/downloads</strong>, where, in place of "ram", you put your Unix login name.<br>
<strong>b)</strong> Move this <code>usrpradio_download</code> directory to under <strong>/usr/local/MATLAB/R2015b/SupportPackages/downloads/</strong><br>
<strong>c)</strong> Install the USRP support package from the above folder by now picking the 'Install from folder' option in the GUI wizard. You might be prompted to login to your MathWorks account.<br>
<strong>d)</strong> Make sure to add all the Support Package folders on MATLAB path. 
Use <em>Set Path</em> from the MATLAB tool tab menu to add path <strong>/usr/local/MATLAB/R2015b/toolbox/shared/hwconnectinstaller</strong>.</p>

<h4>
<a id="3-setting-the-default-matlab-startup-directory-using-ubuntu-os--strictly-optional" class="anchor" href="#3-setting-the-default-matlab-startup-directory-using-ubuntu-os--strictly-optional" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3) Setting the default MATLAB startup directory using Ubuntu OS  (strictly optional)</h4>

<p>Automatically setting the working directory, to say <strong>/usr/local/MATLAB/DTx</strong>, every time we start MATLAB is convenient as you don't have to do this yourself.  To enact this, you could do the following steps:<br> 
<strong>a)</strong> Open up a new Unix terminal and go to your home directory:<br></p>

<pre lang="eval=FALSE"><code>&gt; cd ~
</code></pre>

<p><strong>b)</strong> Edit the files <code>.profile</code> and <code>.bashrc</code> to append the following line at the very end of each file:</p>

<pre lang="eval=FALSE"><code>export MATLAB_USE_USERWORK=1
</code></pre>

<p><strong>c)</strong> Ensure that the shared work directory <strong>/usr/local/MATLAB/DTx</strong> exists on this machine.  If it doesn't, then create it.</p>

<pre lang="eval=FALSE"><code>&gt; cd /usr/local/MATLAB
&gt; ls
&gt; mkdir DTx
&gt; chmod 777 DTx
</code></pre>

<p><strong>d)</strong> Start MATLAB R2015b</p>

<pre lang="eval=FALSE"><code>&gt; matlab
</code></pre>

<p><strong>e)</strong> At the command prompt, run the <code>userpath</code> function to change your starting directory:</p>

<pre lang="eval=FALSE"><code>&gt;&gt; userpath('/usr/local/MATLAB/V40');
&gt;&gt; u=userpath
&gt;&gt; cd(u(1:end-1));
</code></pre>

<p><strong>f)</strong> Close MATLAB and restart your computer using Ubuntu OS. Restart MATLAB and verify that it starts in the shared work directory.</p>

<h4>
<a id="you-are-now-ready-to-run-the-scripts" class="anchor" href="#you-are-now-ready-to-run-the-scripts" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>You are now ready to run the scripts!</h4>

<p>Start with generating the MEX-file for <em>transceive</em> function at DTx and the DRx. To generate the MEX function <code>transceiveXXX_mex()</code> from <code>transceiveXXX()</code>, execute the <code>DTxInitParameters.m</code>/<code>DRxInitParameters.m</code> script to load onto workspace the values of the relevant variables and then, use the <code>codegen</code> as shown below,<br>
<strong>Note</strong>: <code>XXX</code> is the last three digits in the IP address of the corresponding USRP node. For e.g., the node set to IP address, say, <strong>192.168.10.1</strong> will have <code>XXX</code> equated to <code>101</code>. At the DTx, the <code>transceiveXXX()</code> includes a <code>swapFreqFlag</code>, set to <strong>0</strong> by default. By setting it to <strong>1</strong>, the center frequency of the transceiver's Tx and Rx operates in different channels. Essentially, the DTx <em>listens</em> for activity in the <strong>same channel</strong> it will soon <em>transmit</em> the DATA packet from, and switches to a <strong>different channel</strong> when it starts <em>receiving</em> the ACK. We recommend the different channels be separated by an amount greater than the bandwidth of the system, i.e. 1 MHz.<br>
At the DTx,</p>

<pre lang="eval=FALSE"><code>&gt;&gt; DTxInitParameters
&gt;&gt; swapFreqFlag = 0; %same channel operation
&gt;&gt; codegen transceiveXXX -args {complex(zeros(1408,1)),true,txGain,rxGain,centerFreqTx,centerFreqRx,decFactor, intFactor,swapFreqFlag}
</code></pre>

<p>At the DRx,</p>

<pre lang="eval=FALSE"><code>&gt;&gt; DRxInitParameters
&gt;&gt; codegen transceiveXXX -args {complex(zeros(1408,1)),true,txGain,rxGain,centerFreqTx,centerFreqRx,decFactor, intFactor}
</code></pre>

<h3>
<a id="running-the-two-node-1-dtx-and-1-drx-or-the-three-node-2-dtxs-and-1-drx-system" class="anchor" href="#running-the-two-node-1-dtx-and-1-drx-or-the-three-node-2-dtxs-and-1-drx-system" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Running the Two Node (1 DTx and 1 DRx) OR the Three Node (2 DTxs and 1 DRx) System</h3>

<p>The folder <code>DTx</code> and <code>DRx</code> contain the code for the designated transmitter (DTx) and the designated receiver (DRx) respectively. The user can reconfigure the system parameters as needed in the <code>DTxInitParameters</code> and the<code>DRxInitParameters.m</code> file.</p>

<p>Run <code>dtxPHYLayerVisual.m</code> at the DTx(s) and <code>drxPHYLayerVisual.m</code> at the DRx to trasmit an image from the DTx(s) each to the DRx.
Run <code>dtxTestsuite.m</code> at the DTx(s) and <code>drxTestsuite.m</code> at the DRx to test the performance of the corresponding bi-directional link. Performance metrics are Packet Error Rate and Link Latency.</p>
        </section>

        <footer>
          IEEE 802.11b standard compliant link layer code for MATLAB-based SDR is maintained by <a href="https://github.com/80211bSDR">80211bSDR</a><br>
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>
